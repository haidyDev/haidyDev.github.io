<!doctype html>
<html lang="fi">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Näytteet | Osaamisnäytteet dataan, automaatioon ja arkkitehtuuriin | Heidi Maunu</title>
  <meta name="description" content="Osaamisnäytteet rekrytoijalle: suodatettava demosivu data-, automaatio- ja arkkitehtuuriratkaisuista sekä low-code-ajattelusta.">
  <link rel="canonical" href="https://haidydev.github.io/demos/">
  <meta property="og:title" content="Näytteet | Osaamisnäytteet dataan, automaatioon ja arkkitehtuuriin | Heidi Maunu">
  <meta property="og:description" content="Osaamisnäytteet rekrytoijalle: suodatettava demosivu data-, automaatio- ja arkkitehtuuriratkaisuista sekä low-code-ajattelusta.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://haidydev.github.io/demos/">
  <meta property="og:image" content="https://haidydev.github.io/assets/images/cover.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Näytteet | Osaamisnäytteet dataan, automaatioon ja arkkitehtuuriin | Heidi Maunu">
  <meta name="twitter:description" content="Osaamisnäytteet rekrytoijalle: suodatettava demosivu data-, automaatio- ja arkkitehtuuriratkaisuista sekä low-code-ajattelusta.">
  <meta name="twitter:image" content="https://haidydev.github.io/assets/images/cover.png">

  <link rel="stylesheet" href="/assets/css/style.css">
</head>

<body>
  <a class="skip-link" href="#main">Siirry sisältöön</a>

  <!-- ======================
       Header / Navigation
  ======================= -->
  <header class="nav">
    <div class="container nav-inner">
      <div class="brand">
        <span class="name">Heidi Maunu</span>
        <span class="role">Power Platform / low-code -opiskelijaportfolio</span>
      </div>

      <nav class="nav-links">
        <a href="/index.html">Etusivu</a>
        <a href="/projects.html">Laboratorio</a>
        <a href="/demos/">Osaamisnäytteet</a>
        <a href="/about.html">Tietoa</a>
      </nav>
    </div>
  </header>

  <main id="main" tabindex="-1" class="hero">
    <div class="container">
      <section class="card" style="padding: 22px;">
        <h1>Osaamisnäytteet</h1>
        <p>
          Portfolio on fokusoitu neljään pääkategoriaan:
          arkkitehtuuri, automaatio, data &amp; logiikka sekä UI / Sovellukset.
        </p>
        <section class="card" style="margin-top: 12px; padding: 16px;">
          <h2 style="margin-top: 0;">Nostot</h2>
          <article class="card" style="margin-bottom: 10px; padding: 12px; min-height: 260px;">
            <h3 style="margin: 0 0 6px 0;"><a href="/demos/architecture/booking-system-before-after/" data-keep-query="true">Varausjärjestelmä ennen/jälkeen</a></h3>
            <p style="margin: 0 0 4px 0;"><strong>Kategoria:</strong> Arkkitehtuuri</p>
            <p style="margin: 0 0 6px 0;"><strong>Mitä tämä osoittaa:</strong> Arkkitehtuurin nykytila-analyysi ja tavoitetilan suunnittelu käytännön järjestelmämuutoksessa.</p>
            <p style="margin: 0 0 4px 0;"><strong>Tekniikat:</strong></p>
            <ul style="margin: 0 0 0 18px; padding: 0;">
              <li>Power Platform</li>
              <li>Dataverse</li>
              <li>Rajapintojen mallinnus</li>
              <li>Riskienhallinta</li>
            </ul>
          </article>
          <article class="card" style="margin-bottom: 10px; padding: 12px; min-height: 260px;">
            <h3 style="margin: 0 0 6px 0;"><a href="/demos/automation/invoice-triage-flow/" data-keep-query="true">Laskujen triage-automaatio</a></h3>
            <p style="margin: 0 0 4px 0;"><strong>Kategoria:</strong> Automaatio</p>
            <p style="margin: 0 0 6px 0;"><strong>Mitä tämä osoittaa:</strong> Prosessiautomaatioajattelu ja laskudatan sääntöpohjainen reititys.</p>
            <p style="margin: 0 0 4px 0;"><strong>Tekniikat:</strong></p>
            <ul style="margin: 0 0 0 18px; padding: 0;">
              <li>Power Automate</li>
              <li>Ehtologiikka</li>
              <li>Validointi</li>
              <li>Poikkeuspolut</li>
            </ul>
          </article>
          <article class="card" style="margin-bottom: 10px; padding: 12px; min-height: 260px;">
            <h3 style="margin: 0 0 6px 0;"><a href="/demos/data/json-transform-pipeline/" data-keep-query="true">JSON-muunnosputki</a></h3>
            <p style="margin: 0 0 4px 0;"><strong>Kategoria:</strong> Data &amp; logiikka</p>
            <p style="margin: 0 0 6px 0;"><strong>Mitä tämä osoittaa:</strong> Datan muunnoslogiikan rakentaminen niin, että syöte normalisoituu luotettavaan rakenteeseen.</p>
            <p style="margin: 0 0 4px 0;"><strong>Tekniikat:</strong></p>
            <ul style="margin: 0 0 0 18px; padding: 0;">
              <li>JSON</li>
              <li>JavaScript</li>
              <li>Muunnosputki</li>
              <li>Virheenkäsittely</li>
            </ul>
          </article>
          <article class="card" style="margin-bottom: 10px; padding: 12px; min-height: 260px;">
            <h3 style="margin: 0 0 6px 0;"><a href="/demos/lowcode/powerapp-ui-mock/" data-keep-query="true">Power App UI -mock</a></h3>
            <p style="margin: 0 0 4px 0;"><strong>Kategoria:</strong> UI / Sovellukset</p>
            <p style="margin: 0 0 6px 0;"><strong>Mitä tämä osoittaa:</strong> Käyttöliittymäratkaisun suunnittelu selkeälle case-käsittelyprosessille.</p>
            <p style="margin: 0 0 4px 0;"><strong>Tekniikat:</strong></p>
            <ul style="margin: 0 0 0 18px; padding: 0;">
              <li>Power Apps -rakenne</li>
              <li>UX-flow</li>
              <li>Lomakevalidointi</li>
              <li>Statusnäkymä</li>
            </ul>
          </article>
        </section>
        <div style="margin-top: 12px;">
          <label for="demoSearchInput"><strong>Hae näytteistä</strong></label>
          <input id="demoSearchInput" type="search" placeholder="Hae otsikolla, kategoriassa tai tekniikalla..." style="margin-top: 8px; width: 100%; max-width: 460px; padding: 10px 12px; border: 1px solid var(--line); border-radius: 12px; background: rgba(255, 255, 255, 0.06); color: var(--text);">
        </div>
        <div id="filters" style="margin-top: 12px;">
          <p style="margin: 0 0 8px 0;">
            <strong>Suodatin:</strong>
            <button class="btn" id="showAllBtn" type="button" style="margin-left: 8px;">Näytä kaikki</button>
          </p>
          <p id="category-filters" style="margin: 0 0 8px 0;"></p>
          <p id="tag-filters" style="margin: 0;"></p>
        </div>
        <p id="resultsStatus" class="visually-hidden" aria-live="polite"></p>
        <div id="demos-status" class="card" style="margin-top: 12px; padding: 14px; display: none;"></div>
        <div id="demos-root"></div>
        <section class="card" style="margin-top: 12px; padding: 16px;">
          <h2 style="margin-top: 0;">Laboratorio / muut kokeilut</h2>
          <p style="margin: 0 0 10px 0;">Pienemmät kokeilut löytyvät täältä. Ne eivät ole osa päänostoja.</p>
          <div id="lab-root"></div>
        </section>
      </section>
    </div>
  </main>

  <!-- ======================
       Footer
  ======================= -->
  <footer>
    <div class="container footer-inner">
      <span>© 2026 Heidi Maunu</span>

      <span class="footer-note">
        Power Platform · Low-code · Portfolio
      </span>

      <span class="footer-contact">
        📧
        <a href="mailto:heidi.maunu@gmail.com">
          heidi.maunu@gmail.com
        </a>
        &nbsp;·&nbsp;
        🔗
        <a href="https://www.linkedin.com/in/heidimaunu/" target="_blank" rel="noopener">
          LinkedIn
        </a>
      </span>
    </div>
  </footer>

  <script>
    (function () {
      var root = document.getElementById('demos-root');
      var comparisonPanel = document.getElementById('comparison-panel');
      var labRoot = document.getElementById('lab-root');
      var statusBox = document.getElementById('demos-status');
      var searchInput = document.getElementById('demoSearchInput');
      var resultsStatus = document.getElementById('resultsStatus');
      var categoryFiltersRoot = document.getElementById('category-filters');
      var tagFiltersRoot = document.getElementById('tag-filters');
      var showAllBtn = document.getElementById('showAllBtn');
      var solutionCategoryButtons = document.querySelectorAll('[data-solution-category]');
      var categoryOrder = ['Arkkitehtuuri', 'Automaatio', 'Data & logiikka', 'UI / Sovellukset'];
      var INTERACTION_KEY = 'portfolio_interactions';
      var SESSION_KEY = 'demos_session_state';
      var LAZY_BATCH_SIZE = 6;
      var state = {
        allDemos: [],
        demos: [],
        labDemos: [],
        category: null,
        tag: null,
        query: '',
        openPreviewPath: null,
        comparisonPaths: [],
        lastTrackedSearch: '',
        pinnedPath: null,
        previewTrigger: null,
        pendingScrollY: null,
        hasRestoredScroll: false,
        scrollSaveTimer: null,
        lazy: {
          entries: [],
          renderedCount: 0,
          sectionMap: {},
          sentinel: null,
          observer: null
        }
      };

      function trackEvent(type, data) {
        try {
          var raw = localStorage.getItem(INTERACTION_KEY);
          var events = raw ? JSON.parse(raw) : [];
          if (!Array.isArray(events)) {
            events = [];
          }

          events.push({
            type: type,
            data: data || {},
            timestamp: Date.now()
          });

          if (events.length > 200) {
            events = events.slice(events.length - 200);
          }

          localStorage.setItem(INTERACTION_KEY, JSON.stringify(events));
        } catch (error) {
          // Fail silently: tracking must never break UX.
        }
      }

      function saveSessionState() {
        try {
          var payload = {
            category: state.category,
            tag: state.tag,
            query: state.query,
            openPreviewPath: state.openPreviewPath,
            scrollY: window.scrollY || window.pageYOffset || 0
          };
          localStorage.setItem(SESSION_KEY, JSON.stringify(payload));
        } catch (error) {
          // Fail silently.
        }
      }

      function loadSessionState() {
        try {
          var raw = localStorage.getItem(SESSION_KEY);
          if (!raw) return null;
          var parsed = JSON.parse(raw);
          return parsed && typeof parsed === 'object' ? parsed : null;
        } catch (error) {
          return null;
        }
      }

      function getRelatedDemos(currentDemo, allDemos) {
        return (allDemos || [])
          .filter(function (candidate) {
            return candidate.path !== currentDemo.path;
          })
          .map(function (candidate) {
            var score = 0;

            if ((candidate.category || '') === (currentDemo.category || '')) {
              score += 2;
            }

            var currentTags = currentDemo.tags || [];
            var candidateTags = candidate.tags || [];
            currentTags.forEach(function (tag) {
              if (candidateTags.indexOf(tag) !== -1) {
                score += 1;
              }
            });

            var currentStack = currentDemo.stack || [];
            var candidateStack = candidate.stack || [];
            currentStack.forEach(function (item) {
              if (candidateStack.indexOf(item) !== -1) {
                score += 1;
              }
            });

            return {
              demo: candidate,
              score: score
            };
          })
          .filter(function (item) {
            return item.score > 0;
          })
          .sort(function (a, b) {
            if (b.score !== a.score) {
              return b.score - a.score;
            }
            return (a.demo.title || '').localeCompare(b.demo.title || '');
          })
          .slice(0, 3)
          .map(function (item) {
            return item.demo;
          });
      }

      function buildPreviewId(path) {
        return 'preview-' + btoa(encodeURIComponent(path)).replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
      }

      function updateResultsStatus(count) {
        if (!resultsStatus) return;
        resultsStatus.textContent = 'Näkyvissä ' + count + ' näytettä';
      }

      function renderDemoCard(demo) {
        var card = document.createElement('article');
        card.className = 'card';
        if (demo.featured === true) {
          card.className += ' featured-card';
          card.style.border = '1px solid var(--accent)';
        }
        card.style.padding = '16px';
        card.style.marginTop = '12px';
        card.style.minHeight = '240px';
        card.setAttribute('data-demo-card', 'true');
        card.setAttribute('data-demo-path', demo.path);

        var title = document.createElement('h3');
        title.textContent = demo.title;

        var categoryLine = document.createElement('p');
        categoryLine.style.margin = '0 0 6px 0';
        categoryLine.innerHTML = '<strong>Kategoria:</strong> ' + (demo.category || '-');

        var proofText = (demo.why || demo.description || '').trim();
        var proofLine = document.createElement('p');
        proofLine.style.margin = '0 0 6px 0';
        proofLine.innerHTML = '<strong>Mitä tämä osoittaa:</strong> ' + proofText;

        var techniquesLabel = document.createElement('p');
        techniquesLabel.style.margin = '0 0 4px 0';
        techniquesLabel.innerHTML = '<strong>Tekniikat:</strong>';

        var uniqueTechniques = [];
        (demo.stack || []).forEach(function (item) {
          if (item && uniqueTechniques.indexOf(item) === -1) {
            uniqueTechniques.push(item);
          }
        });
        (demo.tags || []).forEach(function (item) {
          if (item && uniqueTechniques.indexOf(item) === -1) {
            uniqueTechniques.push(item);
          }
        });
        if (uniqueTechniques.length < 2 && (demo.evidence || []).length > 0) {
          uniqueTechniques.push(demo.evidence[0]);
        }
        uniqueTechniques = uniqueTechniques.slice(0, 4);

        var techniquesList = document.createElement('ul');
        techniquesList.style.margin = '0 0 10px 18px';
        techniquesList.style.padding = '0';
        techniquesList.style.fontSize = '0.9rem';
        techniquesList.style.color = 'var(--muted)';
        uniqueTechniques.forEach(function (item) {
          var li = document.createElement('li');
          li.textContent = item;
          techniquesList.appendChild(li);
        });

        var actions = document.createElement('p');
        actions.style.display = 'flex';
        actions.style.gap = '8px';
        actions.style.flexWrap = 'wrap';

        var link = document.createElement('a');
        link.className = 'btn';
        link.href = demo.path;
        link.setAttribute('data-keep-query', 'true');
        link.textContent = 'Avaa näyte';
        link.addEventListener('click', function () {
          trackEvent('demo_link_click', {
            title: demo.title,
            path: demo.path,
            category: demo.category || ''
          });
        });
        actions.appendChild(link);

        card.appendChild(title);
        card.appendChild(categoryLine);
        card.appendChild(proofLine);
        card.appendChild(techniquesLabel);
        card.appendChild(techniquesList);
        card.appendChild(actions);
        appendCurrentQueryToLinks(card);

        return card;
      }

      function getDemoCards() {
        return Array.prototype.slice.call(document.querySelectorAll('[data-demo-card="true"]'));
      }

      function focusCardByPath(path) {
        var cards = getDemoCards();
        for (var i = 0; i < cards.length; i += 1) {
          if (cards[i].getAttribute('data-demo-path') === path) {
            cards[i].focus();
            break;
          }
        }
      }

      function moveFocusBetweenCards(currentCard, step) {
        var cards = getDemoCards();
        var currentIndex = cards.indexOf(currentCard);
        if (currentIndex === -1) return;

        var targetIndex = currentIndex + step;
        if (targetIndex < 0 || targetIndex >= cards.length) return;
        cards[targetIndex].focus();
      }

      function closePreview(restoreFocus, focusPath) {
        if (!state.openPreviewPath) return;
        var previousPath = focusPath || state.openPreviewPath;
        state.openPreviewPath = null;
        state.pinnedPath = focusPath || null;
        saveSessionState();
        renderDemos();
        if (restoreFocus && previousPath) {
          var trigger = state.previewTrigger;
          if (trigger && trigger.path === previousPath && trigger.type === 'previewButton') {
            var previewButton = document.querySelector('[data-demo-path="' + previousPath + '"] button[aria-controls="' + buildPreviewId(previousPath) + '"]');
            if (previewButton) {
              previewButton.focus();
            } else {
              focusCardByPath(previousPath);
            }
          } else {
            focusCardByPath(previousPath);
          }
        }
        state.previewTrigger = null;
      }

      function togglePreview(path, restoreFocus, triggerElement) {
        var opening = state.openPreviewPath !== path;
        state.openPreviewPath = opening ? path : null;
        state.pinnedPath = path;
        if (opening) {
          state.previewTrigger = {
            path: path,
            type: triggerElement && triggerElement.tagName === 'BUTTON' ? 'previewButton' : 'card'
          };
        } else {
          state.previewTrigger = null;
        }
        saveSessionState();
        if (opening) {
          var previewDemo = state.demos.find(function (demo) { return demo.path === path; });
          trackEvent('preview_open', {
            title: previewDemo ? previewDemo.title : '',
            path: path
          });
        }
        renderDemos();
        if (opening) {
          var previewPanel = document.getElementById(buildPreviewId(path));
          if (previewPanel) {
            previewPanel.focus();
          }
        } else if (restoreFocus) {
          focusCardByPath(path);
        }
      }

      function getSelectedComparisonDemos() {
        return state.comparisonPaths
          .map(function (path) {
            return state.demos.find(function (demo) { return demo.path === path; }) || null;
          })
          .filter(function (demo) { return !!demo; });
      }

      function toggleComparison(path) {
        var index = state.comparisonPaths.indexOf(path);
        if (index !== -1) {
          state.comparisonPaths.splice(index, 1);
          renderComparisonPanel();
          renderDemos();
          return;
        }

        if (state.comparisonPaths.length >= 3) {
          return;
        }

        state.comparisonPaths.push(path);
        renderComparisonPanel();
        renderDemos();
      }

      function renderComparisonPanel() {
        if (!comparisonPanel) return;
        comparisonPanel.innerHTML = '';

        var selected = getSelectedComparisonDemos();
        if (selected.length < 2) {
          return;
        }

        var card = document.createElement('section');
        card.className = 'card';
        card.style.marginTop = '12px';
        card.style.padding = '14px';

        var topRow = document.createElement('div');
        topRow.style.display = 'flex';
        topRow.style.justifyContent = 'space-between';
        topRow.style.alignItems = 'center';
        topRow.style.gap = '10px';
        topRow.style.flexWrap = 'wrap';

        var title = document.createElement('h3');
        title.style.margin = '0';
        title.textContent = 'Comparison';
        topRow.appendChild(title);

        var clearBtn = document.createElement('button');
        clearBtn.className = 'btn';
        clearBtn.type = 'button';
        clearBtn.textContent = 'Clear comparison';
        clearBtn.addEventListener('click', function () {
          state.comparisonPaths = [];
          renderComparisonPanel();
          renderDemos();
        });
        topRow.appendChild(clearBtn);

        var tableWrap = document.createElement('div');
        tableWrap.style.marginTop = '10px';
        tableWrap.style.overflowX = 'auto';

        var table = document.createElement('table');
        table.style.width = '100%';
        table.style.borderCollapse = 'collapse';
        table.style.fontSize = '0.9rem';

        var fields = [
          { label: 'Otsikko', key: 'title' },
          { label: 'Fokus', key: 'focus' },
          { label: 'Teknologiat', key: 'stack' },
          { label: 'Kategoria', key: 'category' },
          { label: 'Taso', key: 'level' }
        ];

        fields.forEach(function (field) {
          var row = document.createElement('tr');

          var th = document.createElement('th');
          th.textContent = field.label;
          th.style.textAlign = 'left';
          th.style.padding = '8px';
          th.style.borderBottom = '1px solid var(--line)';
          th.style.verticalAlign = 'top';
          row.appendChild(th);

          selected.forEach(function (demo) {
            var td = document.createElement('td');
            td.style.padding = '8px';
            td.style.borderBottom = '1px solid var(--line)';
            td.style.verticalAlign = 'top';

            if (field.key === 'stack') {
              td.textContent = (demo.stack || []).join(' • ');
            } else {
              td.textContent = demo[field.key] || '';
            }
            row.appendChild(td);
          });

          table.appendChild(row);
        });

        tableWrap.appendChild(table);
        card.appendChild(topRow);
        card.appendChild(tableWrap);
        comparisonPanel.appendChild(card);
      }

      function appendCurrentQueryToLinks(container) {
        if (!container) return;

        var query = window.location.search;
        if (!query) return;

        var links = container.querySelectorAll('a[data-keep-query="true"]');
        links.forEach(function (anchor) {
          var href = anchor.getAttribute('href');
          if (!href) return;

          var url = new URL(href, window.location.origin);
          var params = new URLSearchParams(query);
          params.forEach(function (value, key) {
            url.searchParams.set(key, value);
          });

          anchor.setAttribute('href', url.pathname + (url.search ? url.search : '') + (url.hash ? url.hash : ''));
        });
      }

      function createFilterButton(label, onClick) {
        var btn = document.createElement('button');
        btn.className = 'btn';
        btn.type = 'button';
        btn.textContent = label;
        btn.style.marginRight = '8px';
        btn.style.marginBottom = '8px';
        btn.addEventListener('click', onClick);
        return btn;
      }

      function normalizeCategory(category) {
        if (!category) return '';

        var normalized = category.toLowerCase().trim();

        if (normalized === 'low-code' || normalized === 'käyttöliittymä' || normalized === 'frontend/ui' || normalized === 'frontend') {
          return 'UI / Sovellukset';
        }

        return category;
      }

      function normalizeDemo(demo) {
        var next = Object.assign({}, demo);
        next.category = normalizeCategory(demo.category || '');
        return next;
      }

      function getQueryParams() {
        var params = new URLSearchParams(window.location.search);
        return {
          category: params.get('category'),
          tag: params.get('tag'),
          q: params.get('q')
        };
      }

      function updateURLFromFilter() {
        var params = new URLSearchParams();

        if (state.category) {
          params.set('category', state.category);
        }

        if (state.tag) {
          params.set('tag', state.tag);
        }

        if (state.query) {
          params.set('q', state.query);
        }

        var query = params.toString();
        var url = window.location.pathname + (query ? '?' + query : '');
        window.history.pushState({}, '', url);
        saveSessionState();
      }

      function applyFilterFromURL() {
        var params = getQueryParams();
        var requestedCategory = normalizeCategory(params.category);

        var hasCategory = state.demos.some(function (demo) {
          return demo.category === requestedCategory;
        });
        var hasTag = state.demos.some(function (demo) {
          return (demo.tags || []).indexOf(params.tag) !== -1;
        });

        state.category = hasCategory ? requestedCategory : null;
        state.tag = hasTag ? params.tag : null;
        state.query = (params.q || '').trim();

        if (searchInput) {
          searchInput.value = state.query;
        }
      }

      function hasURLDrivenState() {
        var params = getQueryParams();
        return !!(params.category || params.tag || params.q);
      }

      function applySavedSessionState(saved) {
        if (!saved) return;

        if (!hasURLDrivenState()) {
          state.category = saved.category || null;
          state.tag = saved.tag || null;
          state.query = (saved.query || '').trim();
          if (searchInput) {
            searchInput.value = state.query;
          }
        }

        if (saved.openPreviewPath) {
          state.openPreviewPath = saved.openPreviewPath;
          state.pinnedPath = saved.openPreviewPath;
        }

        if (typeof saved.scrollY === 'number' && saved.scrollY >= 0) {
          state.pendingScrollY = saved.scrollY;
          state.hasRestoredScroll = false;
        }
      }

      function restoreScrollPositionIfNeeded() {
        if (state.hasRestoredScroll) return;
        if (typeof state.pendingScrollY !== 'number') return;

        state.hasRestoredScroll = true;
        var y = state.pendingScrollY;
        state.pendingScrollY = null;

        window.requestAnimationFrame(function () {
          window.scrollTo(0, y);
        });
      }

      function bindScrollPersistence() {
        window.addEventListener('scroll', function () {
          if (state.scrollSaveTimer) {
            return;
          }

          state.scrollSaveTimer = window.setTimeout(function () {
            state.scrollSaveTimer = null;
            saveSessionState();
          }, 200);
        }, { passive: true });
      }

      function getFilteredDemos() {
        var normalizedQuery = state.query.toLowerCase();

        return state.demos.filter(function (demo) {
          var categoryMatch = !state.category || demo.category === state.category;
          var tagMatch = !state.tag || (demo.tags || []).indexOf(state.tag) !== -1;

          var searchText = [
            demo.title || '',
            demo.description || '',
            (demo.tags || []).join(' '),
            (demo.stack || []).join(' '),
            demo.focus || '',
            demo.category || ''
          ].join(' ').toLowerCase();
          var searchMatch = !normalizedQuery || searchText.indexOf(normalizedQuery) !== -1;

          return categoryMatch && tagMatch && searchMatch;
        });
      }

      function renderCategorySection(category, demos) {
        var section = document.createElement('section');
        section.style.marginTop = '20px';

        var heading = document.createElement('h2');
        heading.textContent = category;
        section.appendChild(heading);

        demos.forEach(function (demo) {
          section.appendChild(renderDemoCard(demo));
        });

        return section;
      }

      function disconnectLazyObserver() {
        if (state.lazy.observer) {
          state.lazy.observer.disconnect();
          state.lazy.observer = null;
        }
      }

      function buildOrderedEntries(filtered) {
        var featured = filtered.filter(function (demo) {
          return demo.featured === true;
        });
        var nonFeatured = filtered.filter(function (demo) {
          return demo.featured !== true;
        });
        var grouped = nonFeatured.reduce(function (acc, demo) {
          var key = demo.category || 'Other';
          if (!acc[key]) {
            acc[key] = [];
          }
          acc[key].push(demo);
          return acc;
        }, {});

        var orderedCategories = categoryOrder
          .filter(function (category) { return grouped[category] && grouped[category].length > 0; })
          .concat(Object.keys(grouped).filter(function (category) { return categoryOrder.indexOf(category) === -1; }));

        var entries = [];
        featured.forEach(function (demo) {
          entries.push({ category: 'Nostot', demo: demo });
        });
        orderedCategories.forEach(function (category) {
          grouped[category].forEach(function (demo) {
            entries.push({ category: category, demo: demo });
          });
        });

        return entries;
      }

      function ensureLazySection(category) {
        if (state.lazy.sectionMap[category]) {
          return state.lazy.sectionMap[category];
        }

        var section = document.createElement('section');
        section.style.marginTop = '20px';

        var heading = document.createElement('h2');
        heading.textContent = category;
        section.appendChild(heading);

        state.lazy.sectionMap[category] = section;
        root.appendChild(section);
        return section;
      }

      function renderNextLazyBatch(batchSize) {
        var limit = Math.min(state.lazy.renderedCount + batchSize, state.lazy.entries.length);
        for (var i = state.lazy.renderedCount; i < limit; i += 1) {
          var entry = state.lazy.entries[i];
          var section = ensureLazySection(entry.category);
          section.appendChild(renderDemoCard(entry.demo));
        }
        state.lazy.renderedCount = limit;

        if (state.lazy.sentinel) {
          if (state.lazy.renderedCount >= state.lazy.entries.length) {
            state.lazy.sentinel.remove();
            state.lazy.sentinel = null;
            disconnectLazyObserver();
          } else if (!root.contains(state.lazy.sentinel)) {
            root.appendChild(state.lazy.sentinel);
          }
        }
      }

      function setupLazyObserver() {
        disconnectLazyObserver();

        if (!('IntersectionObserver' in window)) {
          renderNextLazyBatch(state.lazy.entries.length);
          return;
        }

        state.lazy.observer = new IntersectionObserver(function (entries) {
          entries.forEach(function (entry) {
            if (entry.isIntersecting) {
              renderNextLazyBatch(LAZY_BATCH_SIZE);
            }
          });
        }, {
          root: null,
          rootMargin: '200px 0px',
          threshold: 0.01
        });

        if (state.lazy.sentinel) {
          state.lazy.observer.observe(state.lazy.sentinel);
        }
      }

      function startLazyRender(filtered) {
        root.innerHTML = '';
        disconnectLazyObserver();

        state.lazy.entries = buildOrderedEntries(filtered);
        state.lazy.renderedCount = 0;
        state.lazy.sectionMap = {};
        state.lazy.sentinel = document.createElement('div');
        state.lazy.sentinel.setAttribute('aria-hidden', 'true');
        state.lazy.sentinel.style.height = '1px';

        var initialCount = LAZY_BATCH_SIZE;
        var keepPath = state.openPreviewPath || state.pinnedPath;
        if (keepPath) {
          var pinnedIndex = state.lazy.entries.findIndex(function (entry) {
            return entry.demo.path === keepPath;
          });
          if (pinnedIndex >= 0) {
            initialCount = Math.max(initialCount, pinnedIndex + 1);
          }
        }

        renderNextLazyBatch(initialCount);
        setupLazyObserver();
      }

      function updateFilterButtonStates() {
        var allButtons = document.querySelectorAll('#filters .btn');
        allButtons.forEach(function (button) {
          button.style.opacity = '0.85';
        });

        if (showAllBtn) {
          showAllBtn.style.opacity = state.category || state.tag ? '0.85' : '1';
        }

        var activeCategoryBtn = document.querySelector('[data-filter-type="category"][data-filter-value="' + state.category + '"]');
        if (activeCategoryBtn) {
          activeCategoryBtn.style.opacity = '1';
        }

        var activeTagBtn = document.querySelector('[data-filter-type="tag"][data-filter-value="' + state.tag + '"]');
        if (activeTagBtn) {
          activeTagBtn.style.opacity = '1';
        }
      }

      function resetAllFilters() {
        state.category = null;
        state.tag = null;
        state.query = '';

        if (searchInput) {
          searchInput.value = '';
        }

        updateURLFromFilter();
      }

      function showEmptyState() {
        root.innerHTML = '';
        statusBox.style.display = 'block';
        statusBox.innerHTML = '';

        var message = document.createElement('p');
        message.style.margin = '0';
        message.textContent = 'Yksikään osaamisnäyte ei vastaa nykyisiä suodattimia.';
        statusBox.appendChild(message);

        var actions = document.createElement('p');
        actions.style.margin = '10px 0 0 0';

        var resetBtn = document.createElement('button');
        resetBtn.className = 'btn';
        resetBtn.type = 'button';
        resetBtn.textContent = 'Nollaa suodattimet';
        resetBtn.addEventListener('click', function () {
          resetAllFilters();
          renderDemos();
        });
        actions.appendChild(resetBtn);

        statusBox.appendChild(actions);
      }

      function hideStatusState() {
        statusBox.style.display = 'none';
        statusBox.innerHTML = '';
      }

      function renderDemos() {
        root.innerHTML = '';

        var filtered = getFilteredDemos();
        updateResultsStatus(filtered.length);
        if (!filtered.length) {
          showEmptyState();
          updateFilterButtonStates();
          return;
        }

        hideStatusState();
        startLazyRender(filtered);
        restoreScrollPositionIfNeeded();

        updateFilterButtonStates();
      }

      function renderLabDemos() {
        if (!labRoot) return;
        labRoot.innerHTML = '';

        if (!state.labDemos.length) {
          var empty = document.createElement('p');
          empty.style.margin = '0';
          empty.textContent = 'Ei erillisiä kokeiluja juuri nyt.';
          labRoot.appendChild(empty);
          return;
        }

        state.labDemos.forEach(function (demo) {
          var item = document.createElement('article');
          item.className = 'card';
          item.style.padding = '12px';
          item.style.marginTop = '10px';

          var title = document.createElement('h3');
          title.style.margin = '0 0 6px 0';
          var link = document.createElement('a');
          link.href = demo.path;
          link.setAttribute('data-keep-query', 'true');
          link.textContent = demo.title;
          title.appendChild(link);

          var meta = document.createElement('p');
          meta.style.margin = '0 0 6px 0';
          meta.innerHTML = '<strong>Kategoria:</strong> ' + (demo.category || 'UI / Sovellukset');

          var what = document.createElement('p');
          what.style.margin = '0 0 6px 0';
          what.innerHTML = '<strong>Mitä tämä osoittaa:</strong> ' + (demo.why || demo.description || '');

          var techniques = document.createElement('p');
          techniques.style.margin = '0';
          techniques.innerHTML = '<strong>Tekniikat:</strong> ' + (demo.stack || []).slice(0, 4).join(' • ');

          item.appendChild(title);
          item.appendChild(meta);
          item.appendChild(what);
          item.appendChild(techniques);
          labRoot.appendChild(item);
        });

        appendCurrentQueryToLinks(labRoot);
      }

      function renderFilters() {
        categoryFiltersRoot.innerHTML = '';
        tagFiltersRoot.innerHTML = '';

        var categories = state.demos
          .map(function (demo) { return demo.category; })
          .filter(function (value, index, arr) { return value && arr.indexOf(value) === index; });

        var sortedCategories = categoryOrder
          .filter(function (category) { return categories.indexOf(category) !== -1; })
          .concat(categories.filter(function (category) { return categoryOrder.indexOf(category) === -1; }));

        if (sortedCategories.length > 0) {
          var categoryLabel = document.createElement('strong');
          categoryLabel.textContent = 'Kategoriat: ';
          categoryFiltersRoot.appendChild(categoryLabel);
        }

        sortedCategories.forEach(function (category) {
          var btn = createFilterButton(category, function () {
            state.category = category;
            trackEvent('filter_used', { filter: 'category', value: category });
            updateURLFromFilter();
            renderDemos();
          });
          btn.setAttribute('data-filter-type', 'category');
          btn.setAttribute('data-filter-value', category);
          categoryFiltersRoot.appendChild(btn);
        });

        var tags = state.demos.reduce(function (acc, demo) {
          (demo.tags || []).forEach(function (tag) {
            if (acc.indexOf(tag) === -1) {
              acc.push(tag);
            }
          });
          return acc;
        }, []).sort();

        if (tags.length > 0) {
          var tagLabel = document.createElement('strong');
          tagLabel.textContent = 'Tagit: ';
          tagFiltersRoot.appendChild(tagLabel);
        }

        tags.forEach(function (tag) {
          var btn = createFilterButton(tag, function () {
            state.tag = tag;
            trackEvent('filter_used', { filter: 'tag', value: tag });
            updateURLFromFilter();
            renderDemos();
          });
          btn.setAttribute('data-filter-type', 'tag');
          btn.setAttribute('data-filter-value', tag);
          tagFiltersRoot.appendChild(btn);
        });

        showAllBtn.addEventListener('click', function () {
          resetAllFilters();
          trackEvent('filter_used', { filter: 'show_all', value: '' });
          renderDemos();
        });

        updateFilterButtonStates();
      }

      function bindSearch() {
        if (!searchInput) return;

        searchInput.addEventListener('input', function () {
          state.query = searchInput.value.trim();
          if (state.query !== state.lastTrackedSearch) {
            trackEvent('search_performed', { query: state.query });
            state.lastTrackedSearch = state.query;
          }
          updateURLFromFilter();
          renderDemos();
        });
      }

      function bindSolutionCategories() {
        solutionCategoryButtons.forEach(function (button) {
          button.addEventListener('click', function () {
            var requestedCategory = normalizeCategory(button.getAttribute('data-solution-category'));
            var fallbackCategory = normalizeCategory(button.getAttribute('data-solution-fallback'));
            var hasRequestedCategory = state.demos.some(function (demo) {
              return demo.category === requestedCategory;
            });
            var targetCategory = hasRequestedCategory ? requestedCategory : fallbackCategory || requestedCategory;
            var existingCategoryBtn = document.querySelector('[data-filter-type="category"][data-filter-value="' + targetCategory + '"]');

            if (existingCategoryBtn) {
              existingCategoryBtn.click();
              return;
            }

            state.category = targetCategory;
            trackEvent('filter_used', { filter: 'category', value: targetCategory });
            updateURLFromFilter();
            renderDemos();
          });
        });
      }

      function bindEscapeToClosePreview() {
        document.addEventListener('keydown', function (event) {
          if (event.key !== 'Escape') return;
          if (!state.openPreviewPath) return;
          event.preventDefault();
          closePreview(true, state.openPreviewPath);
        });
      }

      bindScrollPersistence();
      bindEscapeToClosePreview();

      fetch('./demos.json', { credentials: 'same-origin' })
        .then(function (response) {
          if (!response.ok) {
            throw new Error(response.status + ' ' + response.statusText);
          }
          return response.json();
        })
        .then(function (demos) {
          state.allDemos = demos.map(normalizeDemo);
          state.demos = state.allDemos.filter(function (demo) {
            return demo.is_lab !== true;
          });
          state.labDemos = state.allDemos.filter(function (demo) {
            return demo.is_lab === true;
          });
          state.comparisonPaths = state.comparisonPaths.filter(function (path) {
            return state.demos.some(function (demo) { return demo.path === path; });
          });
          applyFilterFromURL();
          applySavedSessionState(loadSessionState());
          renderFilters();
          renderLabDemos();
          bindSolutionCategories();
          bindSearch();
          renderDemos();
        })
        .catch(function (error) {
          statusBox.style.display = 'block';
          statusBox.innerHTML = '<p style="margin: 0;">Osaamisnäytteiden lataus epäonnistui.</p>';
          console.warn('[demos] Failed to load demos.json', error);
        });
    })();
  </script>

  <button id="backToTop" class="back-to-top" type="button" aria-label="Takaisin ylös" title="Takaisin ylös">
    <span class="back-to-top__icon" aria-hidden="true">↑</span>
  </button>
  <script src="/assets/js/back-to-top.js"></script>
  <script src="/assets/js/nav-active.js"></script>
</body>

</html>
